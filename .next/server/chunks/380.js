exports.id=380,exports.ids=[380],exports.modules={1825:()=>{},4795:(e,r,t)=>{Promise.resolve().then(t.t.bind(t,2994,23)),Promise.resolve().then(t.t.bind(t,6114,23)),Promise.resolve().then(t.t.bind(t,9727,23)),Promise.resolve().then(t.t.bind(t,9671,23)),Promise.resolve().then(t.t.bind(t,1868,23)),Promise.resolve().then(t.t.bind(t,4759,23))},4422:(e,r,t)=>{Promise.resolve().then(t.bind(t,6460))},6460:(e,r,t)=>{"use strict";t.d(r,{Providers:()=>g});var s=t(326),o=t(4976),a=t(5999);let n=new(t(2852)).S({defaultOptions:{queries:{staleTime:3e5,gcTime:6e5,retry:1,refetchOnWindowFocus:!1,refetchOnReconnect:!0},mutations:{retry:0}}});var i=t(7577);let l=(0,i.createContext)(null);function u(e,r){switch(r.type){case"LOGIN":return r.payload.accessToken,r.payload.refreshToken,{...e,user:r.payload.user,accessToken:r.payload.accessToken,refreshToken:r.payload.refreshToken,isAuthenticated:!0,loading:!1};case"LOGOUT":return{user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,loading:!1};case"SET_LOADING":return{...e,loading:r.payload};default:return e}}function c({children:e}){let[r,t]=(0,i.useReducer)(u,{user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,loading:!0});return s.jsx(l.Provider,{value:{state:r,login:(e,r,s)=>{t({type:"LOGIN",payload:{user:e,accessToken:r,refreshToken:s}})},logout:()=>{t({type:"LOGOUT"})}},children:e})}var d=t(9678),h=t(348);function f(){let{isAuthenticated:e,accessToken:r,refreshToken:t,clearAuth:s,isHydrated:o}=(0,d.tN)();return(0,i.useCallback)(s,[s]),(0,h.u)(),null}function g({children:e}){return s.jsx(o.aH,{client:n,children:(0,s.jsxs)(c,{children:[s.jsx(f,{}),e,s.jsx(a.x7,{position:"top-right",richColors:!0})]})})}},348:(e,r,t)=>{"use strict";t.d(r,{G:()=>f,u:()=>g});var s=t(4976),o=t(108),a=t(119),n=t(5047),i=t(5137);let l={startRegistration:async e=>i.x.post("/auth/register-start",e),verifyCode:async e=>i.x.post("/auth/verify",e),signUp:async e=>i.x.post("/auth/register",e),signIn:async e=>i.x.post("/auth/login",e),getUserById:async e=>i.x.get(`/auth/users/user-id/${e}`),updateProfile:async e=>i.x.patch("/auth/profile",e),forgotPassword:async e=>i.x.post("/auth/forgot-password",e),resetPassword:async e=>i.x.post("/auth/reset-password",e)};var u=t(6105),c=t(9678),d=t(7577);process.env.NEXT_PUBLIC_API_BASE_URL;let h=["/dashboard","/request-details"];function f(){let e=(0,s.NL)(),r=(0,n.usePathname)(),t=(0,n.useRouter)(),{setAuth:d,clearAuth:f,isAuthenticated:g,user:p,isHydrated:m,isInitialized:y,setInitialized:P}=(0,c.tN)(),k=h.some(e=>r.startsWith(e)),{data:w,isLoading:A,error:v,refetch:T}=(0,o.a)({queryKey:["auth","user-id"],queryFn:async()=>{try{if(p?.id)return await l.getUserById(p.id);return null}catch(e){if(console.error("Failed to fetch user:",e),e instanceof i.M&&(401===e.status||403===e.status))return console.warn("Authentication failed, clearing auth"),f(),null;return p}},enabled:m&&g&&k&&!!p?.id,retry:1,staleTime:3e5,refetchOnMount:!1,refetchOnWindowFocus:!1}),I=()=>{f(),e.removeQueries({queryKey:["auth","user-id"]}),t.replace("/login")},N=(0,a.D)({mutationFn:e=>l.signIn(e),onSuccess:r=>{if(r.success&&r.data?.data){let{user:t,accessToken:s,refreshToken:o}=r.data.data;d(t,s,o),e.setQueryData(["auth","user-id"],t),(0,u.C)({type:"success",message:`Welcome back, ${t.fullName||t.email}!`})}},onError:e=>{console.error("Sign in error:",e),(0,u.C)({type:"error",message:e.message||"Login failed. Please check your credentials."})}}),C=(0,a.D)({mutationFn:e=>l.startRegistration(e),onSuccess:(e,r)=>{sessionStorage.setItem("onboarding_email",r.email),(0,u.C)({type:"success",message:"Verification code sent to your email!"})},onError:e=>{let r=e.errors?.[0]||e.message||"Failed to send verification code";(0,u.C)({type:"error",message:r})}}),S=(0,a.D)({mutationFn:e=>l.verifyCode(e),onSuccess:(e,r)=>{sessionStorage.setItem("verified_email",r.email),sessionStorage.removeItem("onboarding_email"),(0,u.C)({type:"success",message:"Email verified successfully!"})},onError:e=>{let r=e.errors?.[0]||e.message||"Verification failed";(0,u.C)({type:"error",message:r})}}),b=(0,a.D)({mutationFn:e=>{let r=`${e.firstName} ${e.lastName}`.trim();return l.signUp({email:e.email,password:e.password,firstName:e.firstName,lastName:e.lastName,fullName:r,phone:e.phone,role:e.role??"BUYER",isActive:!0})},onSuccess:()=>{sessionStorage.removeItem("verified_email"),(0,u.C)({type:"success",message:"Account created successfully! Please login."})},onError:e=>{(0,u.C)({type:"error",message:e.message||"Failed to complete profile"})}}),E=(0,a.D)({mutationFn:e=>l.forgotPassword(e),onSuccess:(e,r)=>{sessionStorage.setItem("reset_email",r.email),(0,u.C)({type:"success",message:"Password reset code sent to your email!"})},onError:e=>{console.error("Forgot password error:",e),(0,u.C)({type:"error",message:e.message||"Failed to send reset code",duration:4e3})}}),x=(0,a.D)({mutationFn:({confirmPassword:e,...r})=>l.resetPassword(r),onSuccess:()=>{sessionStorage.removeItem("reset_email"),(0,u.C)({type:"success",message:"Password changed successfully. Please login again."}),I()},onError:e=>{console.error("Reset password error:",e),(0,u.C)({type:"error",message:e.message||"Failed to reset password"})}}),R=(0,a.D)({mutationFn:e=>l.updateProfile(e),onSuccess:r=>{let{user:t,updateUser:s}=c.tN.getState();if(t){let o={...t,...r};s(o),e.setQueryData(["auth","user-id"],o)}(0,u.C)({type:"success",message:"Profile updated successfully!"})},onError:e=>{console.error("Update profile error:",e),(0,u.C)({type:"error",message:e.message||"Failed to update profile"})}}),F=void 0!==w?w:p;return{user:F,loading:A||!y,error:v,isAuthenticated:g&&!!F,refetchUser:T,onboarding:C.mutateAsync,verify:S.mutateAsync,completeProfile:b.mutateAsync,signIn:N.mutateAsync,forgotPassword:E.mutateAsync,resetPassword:x.mutateAsync,signOut:()=>{f(),e.removeQueries({queryKey:["auth","user"]}),t.replace("/")},updateProfile:R.mutateAsync,isOnboarding:C.isPending,isVerifying:S.isPending,isCompletingProfile:b.isPending,isSigningIn:N.isPending,isForgettingPassword:E.isPending,isResettingPassword:x.isPending,isUpdatingProfile:R.isPending,signInError:N.error,onboardingError:C.error,verifyError:S.error,completeProfileError:b.error,forgotPasswordError:E.error,resetPasswordError:x.error,updateProfileError:R.error}}function g(){let{accessToken:e,refreshToken:r,setAuth:t,user:s,clearAuth:o,isAuthenticated:a}=(0,c.tN)();return(0,d.useRef)(null),(0,d.useRef)(!1),(0,d.useRef)(0),null}},5137:(e,r,t)=>{"use strict";t.d(r,{M:()=>n,x:()=>l});var s=t(4464),o=t(9678);let a=process.env.NEXT_PUBLIC_API_BASE_URL;class n extends Error{constructor(e,r,t,s,o,a){super(e),this.status=r,this.code=t,this.errors=s,this.details=o,this.data=a,this.name="ApiError"}}class i{constructor(e){this.isRefreshing=!1,this.failedQueue=[],this.client=s.Z.create({baseURL:e,headers:{"Content-Type":"application/json"},timeout:15e3}),this.setupInterceptors()}setupInterceptors(){this.client.interceptors.request.use(async e=>{let{accessToken:r,isAuthenticated:t,refreshToken:n}=o.tN.getState();if(e.url?.includes("/auth/refresh-token"))return e;if(t&&r){if((0,o.Rm)(r,60)&&n&&!this.isRefreshing)try{this.isRefreshing=!0;let{accessToken:r,refreshToken:t}=(await s.Z.post(`${a}/auth/refresh-token`,{token:n},{headers:{"Content-Type":"application/json"},timeout:1e4})).data.data;o.tN.getState().setAuth(o.tN.getState().user,r,t),e.headers.Authorization=`Bearer ${r}`}catch(t){console.error("❌ API Interceptor: Proactive token refresh failed:",t),e.headers.Authorization=`Bearer ${r}`}finally{this.isRefreshing=!1}else e.headers.Authorization=`Bearer ${r}`}return e},e=>Promise.reject(e)),this.client.interceptors.response.use(e=>e,async e=>{let r=e.config;if(e.response?.status===401&&!r._retry){if(this.isRefreshing)return new Promise((e,r)=>{this.failedQueue.push({resolve:e,reject:r})}).then(()=>{let{accessToken:e}=o.tN.getState();return r.headers&&e&&(r.headers.Authorization=`Bearer ${e}`),this.client(r)}).catch(e=>Promise.reject(e));r._retry=!0,this.isRefreshing=!0;try{let{refreshToken:e}=o.tN.getState();if(!e)throw console.warn("⚠️ API Interceptor: No refresh token available for 401 retry"),Error("No refresh token available");let{accessToken:t,refreshToken:n}=(await s.Z.post(`${a}/auth/refresh-token`,{token:e},{headers:{"Content-Type":"application/json"},timeout:1e4})).data.data;return o.tN.getState().setAuth(o.tN.getState().user,t,n),this.processQueue(null),r.headers&&(r.headers.Authorization=`Bearer ${t}`),this.client(r)}catch(e){return console.error("❌ API Interceptor: Token refresh failed after 401:",e),this.processQueue(e),this.handleLogout(),Promise.reject(this.transformError(e))}finally{this.isRefreshing=!1}}return Promise.reject(this.transformError(e))})}transformError(e){if(e.response){let{data:r,status:t}=e.response;return new n(r?.message||`Request failed with status ${t}`,t,r?.code,r?.errors,r?.details,r)}return"ECONNABORTED"===e.code?new n("Request timeout",0):new n(e.message||"Network error",0)}processQueue(e){this.failedQueue.forEach(r=>{e?r.reject(e):r.resolve()}),this.failedQueue=[]}handleLogout(){let{clearAuth:e}=o.tN.getState();e()}async get(e,r){return(await this.client.get(e,r)).data}async post(e,r,t){return(await this.client.post(e,r,t)).data}async put(e,r,t){return(await this.client.put(e,r,t)).data}async patch(e,r,t){return(await this.client.patch(e,r,t)).data}async delete(e,r){return(await this.client.delete(e,r)).data}}let l=new i(a)},9678:(e,r,t)=>{"use strict";t.d(r,{Rm:()=>n,tN:()=>l});var s=t(8408),o=t(5251);function a(e){if(!e)return!0;try{let r=e.split(".");if(3!==r.length)return!0;let t=JSON.parse(atob(r[1]));if(!t.exp)return!1;let s=Math.floor(Date.now()/1e3);return t.exp<s}catch(e){return console.error("Error decoding token:",e),!0}}function n(e,r=60){if(!e)return!0;try{let t=e.split(".");if(3!==t.length)return!0;let s=JSON.parse(atob(t[1]));if(!s.exp)return!1;let o=Math.floor(Date.now()/1e3);return s.exp<o+r}catch(e){return console.error("Error decoding token:",e),!0}}let i={getItem:e=>null,setItem:(e,r)=>{},removeItem:e=>{}},l=(0,s.U)()((0,o.tJ)((e,r)=>({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,isHydrated:!1,isInitialized:!1,setAuth:(r,t,s)=>{e({user:r,accessToken:t,refreshToken:s||null,isAuthenticated:!0,isHydrated:!0,isInitialized:!0})},updateUser:r=>e(e=>({...e,user:r})),setAccessToken:r=>e({accessToken:r}),clearAuth:()=>{e({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,isHydrated:!0,isInitialized:!0})},setHydrated:r=>e({isHydrated:r}),setInitialized:r=>e({isInitialized:r}),isTokenExpired:()=>{let{accessToken:e}=r();return a(e)}}),{name:"auth-storage",storage:(0,o.FL)(()=>i),partialize:e=>({user:e.user,accessToken:e.accessToken,refreshToken:e.refreshToken,isAuthenticated:e.isAuthenticated}),onRehydrateStorage:()=>e=>{if(e&&(e.isHydrated=!0,e.isAuthenticated&&e.accessToken)){let r=a(e.accessToken),t=!!e.refreshToken;r&&!t&&(console.warn("Token expired and no refresh token available, clearing auth"),e.user=null,e.accessToken=null,e.refreshToken=null,e.isAuthenticated=!1)}}}))},6105:(e,r,t)=>{"use strict";t.d(r,{C:()=>o});var s=t(5999);let o=({type:e,message:r,duration:t=2e3,position:o="top-center"})=>{let a={color:"#fff"},n={success:"#4CAF50",error:"#FF5722",info:"#2196F3",warning:"#FFC107"};switch(s.Am.dismiss(),e){case"success":s.Am.success(r,{duration:t,style:{...a,backgroundColor:n.success},position:o});break;case"error":s.Am.error(r,{duration:t,style:{...a,backgroundColor:n.error},position:o});break;case"info":(0,s.Am)(r,{duration:t,style:{...a,backgroundColor:n.info},position:o});break;case"warning":(0,s.Am)(r,{duration:t,style:{...a,backgroundColor:n.warning},position:o});break;default:console.warn("Invalid toast type")}}},5495:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>n,metadata:()=>a});var s=t(9510);let o=(0,t(8570).createProxy)(String.raw`C:\Users\HP\Desktop\Freelance\afrozonauto-frontend\src\app\providers.tsx#Providers`);t(5023);let a={title:"Afrozon AutoGlobal - Import Verified US Vehicles to Nigeria",description:"Afrozon AutoGlobal is your trusted partner for importing verified vehicles from the United States to Nigeria. We handle sourcing, inspection, shipping, and delivery."};function n({children:e}){return s.jsx("html",{lang:"en",children:s.jsx("body",{children:s.jsx(o,{children:e})})})}},5023:()=>{}};