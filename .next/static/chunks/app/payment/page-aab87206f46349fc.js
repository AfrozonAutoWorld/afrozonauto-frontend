(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[790],{6896:function(e,t,r){Promise.resolve().then(r.bind(r,6806))},9763:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var s=r(2265),n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),i=(e,t)=>{let r=(0,s.forwardRef)((r,i)=>{let{color:o="currentColor",size:c=24,strokeWidth:l=2,absoluteStrokeWidth:u,className:d="",children:h,...f}=r;return(0,s.createElement)("svg",{ref:i,...n,width:c,height:c,stroke:o,strokeWidth:u?24*Number(l)/Number(c):l,className:["lucide","lucide-".concat(a(e)),d].join(" "),...f},[...t.map(e=>{let[t,r]=e;return(0,s.createElement)(t,r)}),...Array.isArray(h)?h:[h]])});return r.displayName="".concat(e),r}},5302:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9763).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},5131:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9763).Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},6806:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return h}});var s=r(7437),n=r(7975),a=r(2265),i=r(9376);let o=(0,r(9763).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);var c=r(5302),l=r(5131),u=r(5155);function d(){let e=(0,i.useRouter)(),t=(0,i.useSearchParams)(),[r,n]=(0,a.useState)("verifying"),[d,h]=(0,a.useState)("Verifying your payment..."),{mutateAsync:f}=(0,u.rZ)();return(0,a.useEffect)(()=>{(async()=>{try{let r=t.get("reference"),s=t.get("trxref"),a=t.get("transaction_id"),i=t.get("cancelled");if("true"===i){n("cancelled"),h("Payment was cancelled. You will be redirected to your dashboard."),setTimeout(()=>e.push("/dashboard"),3e3);return}let o=r||s||a;if(!o){n("failed"),h("No payment reference found. Please contact support if you were charged."),setTimeout(()=>e.push("/dashboard"),5e3);return}h("Verifying payment with payment provider..."),await f({reference:o}),n("success"),h("Payment successful! Redirecting to your dashboard..."),setTimeout(()=>e.push("/dashboard"),2e3)}catch(t){var r,s;console.error("Payment verification failed:",t),n("failed"),(null==t?void 0:null===(s=t.response)||void 0===s?void 0:null===(r=s.data)||void 0===r?void 0:r.message)?h(t.response.data.message):(null==t?void 0:t.message)?h(t.message):h("Payment verification failed. Please contact support if you were charged."),setTimeout(()=>e.push("/dashboard"),5e3)}})()},[t,f,e]),(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-8 max-w-md w-full text-center",children:[(0,s.jsxs)("div",{className:"mb-6",children:["verifying"===r&&(0,s.jsx)("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-blue-100 rounded-full",children:(0,s.jsx)(o,{className:"w-10 h-10 text-blue-600 animate-spin"})}),"success"===r&&(0,s.jsx)("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-green-100 rounded-full",children:(0,s.jsx)(c.Z,{className:"w-10 h-10 text-green-600"})}),("failed"===r||"cancelled"===r)&&(0,s.jsx)("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-red-100 rounded-full",children:(0,s.jsx)(l.Z,{className:"w-10 h-10 text-red-600"})})]}),(0,s.jsxs)("h2",{className:"text-2xl font-bold text-gray-900 mb-3",children:["verifying"===r&&"Processing Payment","success"===r&&"Payment Successful!","failed"===r&&"Payment Failed","cancelled"===r&&"Payment Cancelled"]}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:d}),"verifying"===r&&(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-4",children:(0,s.jsx)("div",{className:"bg-blue-600 h-2 rounded-full animate-pulse w-2/3"})}),("failed"===r||"cancelled"===r)&&(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("button",{onClick:()=>e.push("/dashboard"),className:"w-full bg-emerald-600 text-white py-3 rounded-lg font-medium hover:bg-emerald-700 transition-colors",children:"Go to Dashboard"}),(0,s.jsx)("button",{onClick:()=>e.push("/contact"),className:"w-full border border-gray-300 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-50 transition-colors",children:"Contact Support"})]}),"success"===r&&(0,s.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:(0,s.jsx)("p",{className:"text-sm text-green-800",children:"You will be automatically redirected to your dashboard in a few seconds..."})}),"verifying"===r&&(0,s.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,s.jsx)("p",{className:"text-sm text-blue-800",children:"Please wait while we confirm your payment with the payment provider. This usually takes just a few seconds."})})]})})}function h(){return(0,s.jsx)(n.i,{children:(0,s.jsx)(d,{})})}},7975:function(e,t,r){"use strict";r.d(t,{i:function(){return o}});var s=r(7437),n=r(9376),a=r(4191),i=r(2265);function o(e){let{children:t,redirectTo:r="/login"}=e,o=(0,n.useRouter)(),{isAuthenticated:c,accessToken:l}=(0,a.tN)(),[u,d]=(0,i.useState)(a.tN.persist.hasHydrated());return((0,i.useEffect)(()=>a.tN.persist.onFinishHydration(()=>{d(!0)}),[]),(0,i.useEffect)(()=>{!u||c&&l||o.replace(r)},[u,c,l,o,r]),u&&c&&l)?(0,s.jsx)(s.Fragment,{children:t}):(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"w-10 h-10 border-4 border-emerald-600 border-t-transparent rounded-full animate-spin"})})}},5155:function(e,t,r){"use strict";r.d(t,{qm:function(){return d},vr:function(){return h},rZ:function(){return f}});var s=r(1713),n=r(1770),a=r(9827),i=r(6305);let o=()=>i.x.get("/payments/all"),c=e=>i.x.post("/payments/init",e),l=e=>i.x.patch("/payments/verify/".concat(e,"?provider=paystack"),{});var u=r(999);function d(){let e=(0,s.a)({queryKey:["payments"],queryFn:async()=>(await o()).data.data,staleTime:3e5,refetchOnWindowFocus:!1});return{allPayments:e.data,isLoading:e.isLoading,isError:e.isError,error:e.error,refetch:e.refetch,isFetching:e.isFetching}}let h=()=>(0,n.D)({mutationFn:async e=>(await c(e)).data.data,onSuccess:e=>{(0,u.C)({type:"success",message:"Payment initialized successfully!"}),e.authorizationUrl&&(window.location.href=e.authorizationUrl)},onError:e=>{(0,u.C)({type:"error",message:e.message||"Failed to initialize payment. Please try again."})}}),f=()=>{let e=(0,a.NL)();return(0,n.D)({mutationFn:async e=>{let{reference:t}=e;return(await l(t)).data.data},onSuccess:t=>{let{success:r,message:s}=t;e.invalidateQueries({queryKey:["requests"]}),r?(0,u.C)({type:"success",message:s||"Payment verified successfully!"}):(0,u.C)({type:"error",message:s||"Payment verification failed"})},onError:e=>{(0,u.C)({type:"error",message:e.message||"Failed to verify payment."})}})}},6305:function(e,t,r){"use strict";r.d(t,{M:function(){return i},x:function(){return c}});var s=r(3464),n=r(4191);let a=r(257).env.NEXT_PUBLIC_API_BASE_URL;class i extends Error{constructor(e,t,r,s,n,a){super(e),this.status=t,this.code=r,this.errors=s,this.details=n,this.data=a,this.name="ApiError"}}class o{setupInterceptors(){this.client.interceptors.request.use(async e=>{var t;let{accessToken:r,isAuthenticated:i,refreshToken:o}=n.tN.getState();if(null===(t=e.url)||void 0===t?void 0:t.includes("/auth/refresh-token"))return e;if(i&&r){if((0,n.Rm)(r,60)&&o&&!this.isRefreshing)try{this.isRefreshing=!0;let{accessToken:t,refreshToken:r}=(await s.Z.post("".concat(a,"/auth/refresh-token"),{token:o},{headers:{"Content-Type":"application/json"},timeout:1e4})).data.data;n.tN.getState().setAuth(n.tN.getState().user,t,r),e.headers.Authorization="Bearer ".concat(t)}catch(t){console.error("❌ API Interceptor: Proactive token refresh failed:",t),e.headers.Authorization="Bearer ".concat(r)}finally{this.isRefreshing=!1}else e.headers.Authorization="Bearer ".concat(r)}return e},e=>Promise.reject(e)),this.client.interceptors.response.use(e=>e,async e=>{var t;let r=e.config;if((null===(t=e.response)||void 0===t?void 0:t.status)===401&&!r._retry){if(this.isRefreshing)return new Promise((e,t)=>{this.failedQueue.push({resolve:e,reject:t})}).then(()=>{let{accessToken:e}=n.tN.getState();return r.headers&&e&&(r.headers.Authorization="Bearer ".concat(e)),this.client(r)}).catch(e=>Promise.reject(e));r._retry=!0,this.isRefreshing=!0;try{let{refreshToken:e}=n.tN.getState();if(!e)throw console.warn("⚠️ API Interceptor: No refresh token available for 401 retry"),Error("No refresh token available");let{accessToken:t,refreshToken:i}=(await s.Z.post("".concat(a,"/auth/refresh-token"),{token:e},{headers:{"Content-Type":"application/json"},timeout:1e4})).data.data;return n.tN.getState().setAuth(n.tN.getState().user,t,i),this.processQueue(null),r.headers&&(r.headers.Authorization="Bearer ".concat(t)),this.client(r)}catch(e){return console.error("❌ API Interceptor: Token refresh failed after 401:",e),this.processQueue(e),this.handleLogout(),Promise.reject(this.transformError(e))}finally{this.isRefreshing=!1}}return Promise.reject(this.transformError(e))})}transformError(e){if(e.response){let{data:t,status:r}=e.response;return new i((null==t?void 0:t.message)||"Request failed with status ".concat(r),r,null==t?void 0:t.code,null==t?void 0:t.errors,null==t?void 0:t.details,t)}return"ECONNABORTED"===e.code?new i("Request timeout",0):new i(e.message||"Network error",0)}processQueue(e){this.failedQueue.forEach(t=>{e?t.reject(e):t.resolve()}),this.failedQueue=[]}handleLogout(){let{clearAuth:e}=n.tN.getState();e();{let e=window.location.pathname;["/dashboard","/request-details"].some(t=>e.startsWith(t))&&(window.location.href="/login")}}async get(e,t){return(await this.client.get(e,t)).data}async post(e,t,r){return(await this.client.post(e,t,r)).data}async put(e,t,r){return(await this.client.put(e,t,r)).data}async patch(e,t,r){return(await this.client.patch(e,t,r)).data}async delete(e,t){return(await this.client.delete(e,t)).data}constructor(e){this.isRefreshing=!1,this.failedQueue=[],this.client=s.Z.create({baseURL:e,headers:{"Content-Type":"application/json"},timeout:15e3}),this.setupInterceptors()}}let c=new o(a)},4191:function(e,t,r){"use strict";r.d(t,{Rm:function(){return i},mc:function(){return a},tN:function(){return c}});var s=r(3011),n=r(6885);function a(e){if(!e)return!0;try{let t=e.split(".");if(3!==t.length)return!0;let r=JSON.parse(atob(t[1]));if(!r.exp)return!1;let s=Math.floor(Date.now()/1e3);return r.exp<s}catch(e){return console.error("Error decoding token:",e),!0}}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:60;if(!e)return!0;try{let r=e.split(".");if(3!==r.length)return!0;let s=JSON.parse(atob(r[1]));if(!s.exp)return!1;let n=Math.floor(Date.now()/1e3);return s.exp<n+t}catch(e){return console.error("Error decoding token:",e),!0}}let o={getItem:e=>{let t=localStorage.getItem(e);return t?JSON.parse(t):null},setItem:(e,t)=>{localStorage.setItem(e,JSON.stringify(t))},removeItem:e=>{localStorage.removeItem(e)}},c=(0,s.U)()((0,n.tJ)((e,t)=>({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,isHydrated:!1,isInitialized:!1,setAuth:(t,r,s)=>{e({user:t,accessToken:r,refreshToken:s||null,isAuthenticated:!0,isHydrated:!0,isInitialized:!0})},updateUser:t=>e(e=>({...e,user:t})),setAccessToken:t=>e({accessToken:t}),clearAuth:()=>{e({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,isHydrated:!0,isInitialized:!0})},setHydrated:t=>e({isHydrated:t}),setInitialized:t=>e({isInitialized:t}),isTokenExpired:()=>{let{accessToken:e}=t();return a(e)}}),{name:"auth-storage",storage:(0,n.FL)(()=>o),partialize:e=>({user:e.user,accessToken:e.accessToken,refreshToken:e.refreshToken,isAuthenticated:e.isAuthenticated}),onRehydrateStorage:()=>e=>{if(e&&(e.isHydrated=!0,e.isAuthenticated&&e.accessToken)){let t=a(e.accessToken),r=!!e.refreshToken;t&&!r&&(console.warn("Token expired and no refresh token available, clearing auth"),e.user=null,e.accessToken=null,e.refreshToken=null,e.isAuthenticated=!1)}}}))},999:function(e,t,r){"use strict";r.d(t,{C:function(){return n}});var s=r(4438);let n=e=>{let{type:t,message:r,duration:n=2e3,position:a="top-center"}=e,i={color:"#fff"},o={success:"#4CAF50",error:"#FF5722",info:"#2196F3",warning:"#FFC107"};switch(s.Am.dismiss(),t){case"success":s.Am.success(r,{duration:n,style:{...i,backgroundColor:o.success},position:a});break;case"error":s.Am.error(r,{duration:n,style:{...i,backgroundColor:o.error},position:a});break;case"info":(0,s.Am)(r,{duration:n,style:{...i,backgroundColor:o.info},position:a});break;case"warning":(0,s.Am)(r,{duration:n,style:{...i,backgroundColor:o.warning},position:a});break;default:console.warn("Invalid toast type")}}}},function(e){e.O(0,[753,428,464,971,117,744],function(){return e(e.s=6896)}),_N_E=e.O()}]);