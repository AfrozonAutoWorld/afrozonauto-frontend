(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[828],{8357:function(e,t,r){Promise.resolve().then(r.bind(r,8152))},8152:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return N}});var a=r(7437),n=r(9376),s=r(2265),l=r(7648),i=r(7662),c=r(1047),o=r(476),u=r(8728),d=r(7928),m=r(2805),h=r(2660),x=r(2451),f=r(407),p=r(3774),g=r(8906),v=r(862),y=r(4191);function b(e){var t,r,b;let{vehicleId:N}=e,j=(0,n.useRouter)(),{data:k,isLoading:w,error:T}=(0,v.ZP)(N),{isAuthenticated:S}=(0,y.tN)(),[q,_]=(0,s.useState)(0);if(w)return(0,a.jsx)("div",{className:"min-h-[60vh] flex items-center justify-center",children:(0,a.jsx)("div",{className:"w-10 h-10 border-4 border-emerald-600 border-t-transparent rounded-full animate-spin"})});if(T||!k)return(0,a.jsxs)("div",{className:"max-w-2xl mx-auto px-4 py-16 text-center",children:[(0,a.jsx)(i.Z,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Vehicle Not Found"}),(0,a.jsx)("p",{className:"text-gray-500 mb-6",children:"This vehicle may no longer be available."}),(0,a.jsx)(l.default,{href:"/vehicles",className:"text-emerald-600 hover:text-emerald-700 font-medium",children:"Browse Vehicles"})]});let I=(null===(t=k.images)||void 0===t?void 0:t.sort((e,t)=>e.sort_order-t.sort_order))||[],Z=k.title||"".concat(k.year," ").concat(k.make," ").concat(k.model),A=[{icon:c.Z,label:"Year",value:k.year},{icon:o.Z,label:"Mileage",value:k.mileage>0?"".concat(k.mileage.toLocaleString()," mi"):"N/A"},{icon:u.Z,label:"Transmission",value:k.transmission},{icon:d.Z,label:"Fuel Type",value:k.fuel_type},{icon:i.Z,label:"Drivetrain",value:k.drivetrain},{icon:u.Z,label:"Engine",value:k.engine_size||"N/A"},{icon:m.Z,label:"Exterior",value:k.exterior_color||"N/A"},{icon:m.Z,label:"Interior",value:k.interior_color||"N/A"}];return(0,a.jsxs)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsxs)("button",{onClick:()=>j.back(),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-6 transition-colors",children:[(0,a.jsx)(h.Z,{className:"w-4 h-4"}),"Back to Vehicles"]}),(0,a.jsxs)("div",{className:"grid lg:grid-cols-5 gap-8",children:[(0,a.jsxs)("div",{className:"lg:col-span-3",children:[(0,a.jsx)("div",{className:"bg-gray-100 rounded-2xl overflow-hidden relative aspect-[16/10]",children:I.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("img",{src:null===(r=I[q])||void 0===r?void 0:r.url,alt:Z,className:"w-full h-full object-cover"}),I.length>1&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>_(e=>0===e?I.length-1:e-1),className:"absolute left-3 top-1/2 -translate-y-1/2 w-10 h-10 bg-white/80 hover:bg-white rounded-full flex items-center justify-center shadow-md transition-colors",children:(0,a.jsx)(x.Z,{className:"w-5 h-5"})}),(0,a.jsx)("button",{onClick:()=>_(e=>e===I.length-1?0:e+1),className:"absolute right-3 top-1/2 -translate-y-1/2 w-10 h-10 bg-white/80 hover:bg-white rounded-full flex items-center justify-center shadow-md transition-colors",children:(0,a.jsx)(f.Z,{className:"w-5 h-5"})}),(0,a.jsx)("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 flex gap-1.5",children:I.map((e,t)=>(0,a.jsx)("button",{onClick:()=>_(t),className:"w-2 h-2 rounded-full transition-colors ".concat(t===q?"bg-white":"bg-white/50")},t))})]})]}):(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,a.jsx)(i.Z,{className:"w-16 h-16 text-gray-300"})})}),I.length>1&&(0,a.jsx)("div",{className:"flex gap-2 mt-4 overflow-x-auto pb-2",children:I.map((e,t)=>(0,a.jsx)("button",{onClick:()=>_(t),className:"w-20 h-14 rounded-lg overflow-hidden flex-shrink-0 border-2 transition-colors ".concat(t===q?"border-emerald-600":"border-transparent"),children:(0,a.jsx)("img",{src:e.url,alt:"",className:"w-full h-full object-cover"})},e.id))}),k.description&&(0,a.jsxs)("div",{className:"mt-8",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Description"}),(0,a.jsx)("p",{className:"text-gray-600 whitespace-pre-line",children:k.description})]}),(null===(b=k.features)||void 0===b?void 0:b.length)>0&&(0,a.jsxs)("div",{className:"mt-8",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Features"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:k.features.map((e,t)=>(0,a.jsx)("span",{className:"bg-gray-100 text-gray-700 text-sm px-3 py-1.5 rounded-full",children:e},t))})]})]}),(0,a.jsx)("div",{className:"lg:col-span-2",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6 sticky top-24",children:[(0,a.jsx)("span",{className:"inline-block bg-emerald-100 text-emerald-700 text-xs font-medium px-2.5 py-1 rounded-full mb-4",children:"Marketplace Listing"}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:Z}),(k.location_city||k.location_state)&&(0,a.jsxs)("div",{className:"flex items-center gap-1 text-sm text-gray-500 mb-4",children:[(0,a.jsx)(p.Z,{className:"w-4 h-4"}),[k.location_city,k.location_state].filter(Boolean).join(", ")]}),(0,a.jsxs)("p",{className:"text-3xl font-bold text-emerald-600 mb-6",children:["$",Number(k.price_usd).toLocaleString()]}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-3 mb-6",children:A.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)(e.icon,{className:"w-4 h-4 text-gray-400"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"text-gray-500",children:[e.label,": "]}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:e.value})]})]},e.label))}),k.vin&&(0,a.jsxs)("div",{className:"text-sm text-gray-500 mb-6 bg-gray-50 rounded-lg px-3 py-2",children:["VIN: ",(0,a.jsx)("span",{className:"font-mono text-gray-700",children:k.vin})]}),(0,a.jsx)("div",{className:"space-y-3",children:S?(0,a.jsx)(l.default,{href:"/marketplace/request/".concat(N),className:"block w-full bg-emerald-600 text-white py-3.5 rounded-lg font-semibold hover:bg-emerald-700 transition-colors text-center",children:"Request This Vehicle"}):(0,a.jsx)(l.default,{href:"/login",className:"block w-full bg-emerald-600 text-white py-3.5 rounded-lg font-semibold hover:bg-emerald-700 transition-colors text-center",children:"Sign In to Request"})}),(0,a.jsxs)("div",{className:"mt-4 flex items-center gap-2 text-xs text-gray-500",children:[(0,a.jsx)(g.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"All purchases are verified and secured"})]})]})})]})]})}function N(){let e=(0,n.useParams)();return(0,a.jsx)(b,{vehicleId:e.id})}},862:function(e,t,r){"use strict";r.d(t,{CX:function(){return f},Iy:function(){return h},ZP:function(){return o},dW:function(){return x},eV:function(){return c},hr:function(){return u},p3:function(){return p},r_:function(){return d},vP:function(){return m}});var a=r(1713),n=r(9827),s=r(1770),l=r(4191);async function i(e,t){let r=await fetch(e,{...t,headers:{...function(){let{accessToken:e}=l.tN.getState();return{"Content-Type":"application/json",...e?{Authorization:"Bearer ".concat(e)}:{}}}(),...null==t?void 0:t.headers}});if(!r.ok)throw Error((await r.json().catch(()=>({error:"Request failed"}))).error||"HTTP ".concat(r.status));return r.json()}function c(e,t){let r=new URLSearchParams;return e&&r.set("scope",e),t&&r.set("status",t),(0,a.a)({queryKey:["marketplace-vehicles",e,t],queryFn:()=>i("/api/marketplace/vehicles?".concat(r))})}function o(e){return(0,a.a)({queryKey:["marketplace-vehicle",e],queryFn:()=>i("/api/marketplace/vehicles/".concat(e)),enabled:!!e})}function u(){let e=(0,n.NL)();return(0,s.D)({mutationFn:e=>i("/api/marketplace/vehicles",{method:"POST",body:JSON.stringify(e)}),onSuccess:()=>{e.invalidateQueries({queryKey:["marketplace-vehicles"]})}})}function d(){let e=(0,n.NL)();return(0,s.D)({mutationFn:e=>{let{id:t,data:r}=e;return i("/api/marketplace/vehicles/".concat(t),{method:"PUT",body:JSON.stringify(r)})},onSuccess:(t,r)=>{let{id:a}=r;e.invalidateQueries({queryKey:["marketplace-vehicles"]}),e.invalidateQueries({queryKey:["marketplace-vehicle",a]})}})}function m(){let e=(0,n.NL)();return(0,s.D)({mutationFn:e=>i("/api/marketplace/vehicles/".concat(e),{method:"DELETE"}),onSuccess:()=>{e.invalidateQueries({queryKey:["marketplace-vehicles"]})}})}function h(){let e=(0,n.NL)();return(0,s.D)({mutationFn:e=>i("/api/marketplace/vehicles/".concat(e,"/submit"),{method:"POST"}),onSuccess:()=>{e.invalidateQueries({queryKey:["marketplace-vehicles"]})}})}function x(){let e=(0,n.NL)();return(0,s.D)({mutationFn:e=>i("/api/marketplace/requests",{method:"POST",body:JSON.stringify(e)}),onSuccess:()=>{e.invalidateQueries({queryKey:["vehicle-requests"]})}})}function f(){return(0,a.a)({queryKey:["notifications","unread"],queryFn:()=>i("/api/marketplace/notifications?unread=true"),refetchInterval:15e3})}function p(){let e=(0,n.NL)();return(0,s.D)({mutationFn:e=>i("/api/marketplace/notifications/".concat(e,"/read"),{method:"POST"}),onSuccess:()=>{e.invalidateQueries({queryKey:["notifications"]})}})}},4191:function(e,t,r){"use strict";r.d(t,{Rm:function(){return l},mc:function(){return s},tN:function(){return c}});var a=r(3011),n=r(6885);function s(e){if(!e)return!0;try{let t=e.split(".");if(3!==t.length)return!0;let r=JSON.parse(atob(t[1]));if(!r.exp)return!1;let a=Math.floor(Date.now()/1e3);return r.exp<a}catch(e){return console.error("Error decoding token:",e),!0}}function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:60;if(!e)return!0;try{let r=e.split(".");if(3!==r.length)return!0;let a=JSON.parse(atob(r[1]));if(!a.exp)return!1;let n=Math.floor(Date.now()/1e3);return a.exp<n+t}catch(e){return console.error("Error decoding token:",e),!0}}let i={getItem:e=>{let t=localStorage.getItem(e);return t?JSON.parse(t):null},setItem:(e,t)=>{localStorage.setItem(e,JSON.stringify(t))},removeItem:e=>{localStorage.removeItem(e)}},c=(0,a.U)()((0,n.tJ)((e,t)=>({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,isHydrated:!1,isInitialized:!1,setAuth:(t,r,a)=>{e({user:t,accessToken:r,refreshToken:a||null,isAuthenticated:!0,isHydrated:!0,isInitialized:!0})},updateUser:t=>e(e=>({...e,user:t})),setAccessToken:t=>e({accessToken:t}),clearAuth:()=>{e({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,isHydrated:!0,isInitialized:!0})},setHydrated:t=>e({isHydrated:t}),setInitialized:t=>e({isInitialized:t}),isTokenExpired:()=>{let{accessToken:e}=t();return s(e)}}),{name:"auth-storage",storage:(0,n.FL)(()=>i),partialize:e=>({user:e.user,accessToken:e.accessToken,refreshToken:e.refreshToken,isAuthenticated:e.isAuthenticated}),onRehydrateStorage:()=>e=>{if(e&&(e.isHydrated=!0,e.isAuthenticated&&e.accessToken)){let t=s(e.accessToken),r=!!e.refreshToken;t&&!r&&(console.warn("Token expired and no refresh token available, clearing auth"),e.user=null,e.accessToken=null,e.refreshToken=null,e.isAuthenticated=!1)}}}))}},function(e){e.O(0,[753,451,995,971,117,744],function(){return e(e.s=8357)}),_N_E=e.O()}]);