(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[313],{9395:function(e,t,r){Promise.resolve().then(r.bind(r,3118))},2660:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9763).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},7662:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9763).Z)("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]])},5302:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9763).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},8226:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9763).Z)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])},3774:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9763).Z)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},8906:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9763).Z)("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]])},3118:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return b}});var s=r(7437),a=r(9376),n=r(7975),i=r(2265),l=r(7648),c=r(7662),o=r(5302),d=r(2660),u=r(3774),m=r(8226),h=r(8906);let x=(0,r(9763).Z)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);var f=r(862),y=r(3053),p=r(999);function g(e){var t,r,n,g;let{vehicleId:b}=e,v=(0,a.useRouter)(),{data:N,isLoading:j,error:k}=(0,f.ZP)(b),w=(0,f.dW)(),[S,q]=(0,i.useState)(""),[T,C]=(0,i.useState)(!1);if(j)return(0,s.jsx)("div",{className:"min-h-[60vh] flex items-center justify-center",children:(0,s.jsx)("div",{className:"w-10 h-10 border-4 border-emerald-600 border-t-transparent rounded-full animate-spin"})});if(k||!N)return(0,s.jsxs)("div",{className:"max-w-2xl mx-auto px-4 py-16 text-center",children:[(0,s.jsx)(c.Z,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Vehicle Not Found"}),(0,s.jsx)("p",{className:"text-gray-500 mb-6",children:"This vehicle may no longer be available."}),(0,s.jsx)(l.default,{href:"/vehicles",className:"text-emerald-600 hover:text-emerald-700 font-medium",children:"Browse Vehicles"})]});let A=(null===(r=N.images)||void 0===r?void 0:null===(t=r.find(e=>e.is_primary))||void 0===t?void 0:t.url)||(null===(g=N.images)||void 0===g?void 0:null===(n=g[0])||void 0===n?void 0:n.url),E=y.Jo,P=N.price_usd-E,D=async()=>{try{await w.mutateAsync({vehicle_id:b,notes:S}),C(!0),(0,p.C)({type:"success",message:"Request created! Pay your deposit to proceed."})}catch(t){let e=t instanceof Error?t.message:"Failed to create request";(0,p.C)({type:"error",message:e})}};return T?(0,s.jsxs)("div",{className:"max-w-2xl mx-auto px-4 py-16 text-center",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,s.jsx)(o.Z,{className:"w-8 h-8 text-emerald-600"})}),(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-3",children:"Request Created"}),(0,s.jsxs)("p",{className:"text-gray-600 mb-8 max-w-md mx-auto",children:["Your request for the ",N.year," ",N.make," ",N.model," has been created. Head to your dashboard to pay the deposit and proceed with the purchase."]}),(0,s.jsxs)("div",{className:"flex items-center justify-center gap-4",children:[(0,s.jsx)("button",{onClick:()=>v.push("/dashboard"),className:"bg-emerald-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-emerald-700 transition-colors",children:"Go to Dashboard"}),(0,s.jsx)(l.default,{href:"/vehicles",className:"text-gray-600 hover:text-gray-900 font-medium",children:"Continue Browsing"})]})]}):(0,s.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,s.jsxs)("button",{onClick:()=>v.back(),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-6 transition-colors",children:[(0,s.jsx)(d.Z,{className:"w-4 h-4"}),"Back"]}),(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden",children:[(0,s.jsxs)("div",{className:"bg-gradient-to-r from-gray-900 to-emerald-900 px-6 py-8 text-white",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"Request Vehicle"}),(0,s.jsx)("p",{className:"text-emerald-200",children:"Submit a purchase request and pay a deposit to secure this vehicle."})]}),(0,s.jsxs)("div",{className:"p-6 lg:p-8",children:[(0,s.jsxs)("div",{className:"flex flex-col md:flex-row gap-6 mb-8 pb-8 border-b border-gray-100",children:[(0,s.jsx)("div",{className:"w-full md:w-48 h-36 bg-gray-100 rounded-xl overflow-hidden flex-shrink-0",children:A?(0,s.jsx)("img",{src:A,alt:N.title,className:"w-full h-full object-cover"}):(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,s.jsx)(c.Z,{className:"w-10 h-10 text-gray-300"})})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-1",children:N.title||"".concat(N.year," ").concat(N.make," ").concat(N.model)}),(0,s.jsxs)("p",{className:"text-gray-500 mb-3",children:[N.year," ",N.make," ",N.model," - ",N.transmission," - ",N.fuel_type]}),(N.location_city||N.location_state)&&(0,s.jsxs)("div",{className:"flex items-center gap-1 text-sm text-gray-500 mb-2",children:[(0,s.jsx)(u.Z,{className:"w-4 h-4"}),[N.location_city,N.location_state].filter(Boolean).join(", ")]}),(0,s.jsxs)("p",{className:"text-2xl font-bold text-emerald-600",children:["$",Number(N.price_usd).toLocaleString()]})]})]}),(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-6 mb-8",children:[(0,s.jsxs)("div",{className:"bg-emerald-50 rounded-xl p-5",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,s.jsx)(m.Z,{className:"w-5 h-5 text-emerald-600"}),(0,s.jsx)("h3",{className:"font-semibold text-gray-900",children:"Payment Breakdown"})]}),(0,s.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Deposit (due now)"}),(0,s.jsxs)("span",{className:"font-semibold text-gray-900",children:["$",E.toLocaleString()]})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Remaining balance"}),(0,s.jsxs)("span",{className:"font-semibold text-gray-900",children:["$",P.toLocaleString()]})]}),(0,s.jsxs)("div",{className:"border-t border-emerald-200 pt-2 mt-2 flex justify-between",children:[(0,s.jsx)("span",{className:"font-medium text-gray-900",children:"Total"}),(0,s.jsxs)("span",{className:"font-bold text-emerald-700",children:["$",Number(N.price_usd).toLocaleString()]})]})]})]}),(0,s.jsxs)("div",{className:"bg-gray-50 rounded-xl p-5",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,s.jsx)(h.Z,{className:"w-5 h-5 text-gray-700"}),(0,s.jsx)("h3",{className:"font-semibold text-gray-900",children:"How It Works"})]}),(0,s.jsxs)("ol",{className:"space-y-2 text-sm text-gray-600",children:[(0,s.jsxs)("li",{className:"flex gap-2",children:[(0,s.jsx)("span",{className:"flex-shrink-0 w-5 h-5 bg-emerald-600 text-white text-xs rounded-full flex items-center justify-center font-medium",children:"1"}),"Pay a refundable deposit to show commitment"]}),(0,s.jsxs)("li",{className:"flex gap-2",children:[(0,s.jsx)("span",{className:"flex-shrink-0 w-5 h-5 bg-emerald-600 text-white text-xs rounded-full flex items-center justify-center font-medium",children:"2"}),"Our team verifies the vehicle availability"]}),(0,s.jsxs)("li",{className:"flex gap-2",children:[(0,s.jsx)("span",{className:"flex-shrink-0 w-5 h-5 bg-emerald-600 text-white text-xs rounded-full flex items-center justify-center font-medium",children:"3"}),"Pay the remaining balance to complete your purchase"]})]})]})]}),(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (optional)"}),(0,s.jsx)("textarea",{value:S,onChange:e=>q(e.target.value),placeholder:"Any specific questions or requirements...",rows:3,className:"w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all resize-none"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-6 p-4 bg-amber-50 border border-amber-200 rounded-lg",children:[(0,s.jsx)(x,{className:"w-5 h-5 text-amber-600 flex-shrink-0"}),(0,s.jsxs)("p",{className:"text-sm text-amber-800",children:["A deposit of ",(0,s.jsxs)("strong",{children:["$",E.toLocaleString()]})," is required to proceed. You will be able to pay after creating the request."]})]}),(0,s.jsx)("button",{onClick:D,disabled:w.isPending,className:"w-full bg-emerald-600 text-white py-3.5 rounded-lg font-semibold hover:bg-emerald-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:w.isPending?(0,s.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m.Z,{className:"w-5 h-5"}),"Submit Purchase Request"]})})]})]})]})}function b(){let e=(0,a.useParams)();return(0,s.jsx)(n.i,{children:(0,s.jsx)(g,{vehicleId:e.id})})}},7975:function(e,t,r){"use strict";r.d(t,{i:function(){return l}});var s=r(7437),a=r(9376),n=r(4191),i=r(2265);function l(e){let{children:t,redirectTo:r="/login"}=e,l=(0,a.useRouter)(),{isAuthenticated:c,accessToken:o}=(0,n.tN)(),[d,u]=(0,i.useState)(n.tN.persist.hasHydrated());return((0,i.useEffect)(()=>n.tN.persist.onFinishHydration(()=>{u(!0)}),[]),(0,i.useEffect)(()=>{!d||c&&o||l.replace(r)},[d,c,o,l,r]),d&&c&&o)?(0,s.jsx)(s.Fragment,{children:t}):(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"w-10 h-10 border-4 border-emerald-600 border-t-transparent rounded-full animate-spin"})})}},862:function(e,t,r){"use strict";r.d(t,{CX:function(){return f},Iy:function(){return h},ZP:function(){return o},dW:function(){return x},eV:function(){return c},hr:function(){return d},p3:function(){return y},r_:function(){return u},vP:function(){return m}});var s=r(1713),a=r(9827),n=r(1770),i=r(4191);async function l(e,t){let r=await fetch(e,{...t,headers:{...function(){let{accessToken:e}=i.tN.getState();return{"Content-Type":"application/json",...e?{Authorization:"Bearer ".concat(e)}:{}}}(),...null==t?void 0:t.headers}});if(!r.ok)throw Error((await r.json().catch(()=>({error:"Request failed"}))).error||"HTTP ".concat(r.status));return r.json()}function c(e,t){let r=new URLSearchParams;return e&&r.set("scope",e),t&&r.set("status",t),(0,s.a)({queryKey:["marketplace-vehicles",e,t],queryFn:()=>l("/api/marketplace/vehicles?".concat(r))})}function o(e){return(0,s.a)({queryKey:["marketplace-vehicle",e],queryFn:()=>l("/api/marketplace/vehicles/".concat(e)),enabled:!!e})}function d(){let e=(0,a.NL)();return(0,n.D)({mutationFn:e=>l("/api/marketplace/vehicles",{method:"POST",body:JSON.stringify(e)}),onSuccess:()=>{e.invalidateQueries({queryKey:["marketplace-vehicles"]})}})}function u(){let e=(0,a.NL)();return(0,n.D)({mutationFn:e=>{let{id:t,data:r}=e;return l("/api/marketplace/vehicles/".concat(t),{method:"PUT",body:JSON.stringify(r)})},onSuccess:(t,r)=>{let{id:s}=r;e.invalidateQueries({queryKey:["marketplace-vehicles"]}),e.invalidateQueries({queryKey:["marketplace-vehicle",s]})}})}function m(){let e=(0,a.NL)();return(0,n.D)({mutationFn:e=>l("/api/marketplace/vehicles/".concat(e),{method:"DELETE"}),onSuccess:()=>{e.invalidateQueries({queryKey:["marketplace-vehicles"]})}})}function h(){let e=(0,a.NL)();return(0,n.D)({mutationFn:e=>l("/api/marketplace/vehicles/".concat(e,"/submit"),{method:"POST"}),onSuccess:()=>{e.invalidateQueries({queryKey:["marketplace-vehicles"]})}})}function x(){let e=(0,a.NL)();return(0,n.D)({mutationFn:e=>l("/api/marketplace/requests",{method:"POST",body:JSON.stringify(e)}),onSuccess:()=>{e.invalidateQueries({queryKey:["vehicle-requests"]})}})}function f(){return(0,s.a)({queryKey:["notifications","unread"],queryFn:()=>l("/api/marketplace/notifications?unread=true"),refetchInterval:15e3})}function y(){let e=(0,a.NL)();return(0,n.D)({mutationFn:e=>l("/api/marketplace/notifications/".concat(e,"/read"),{method:"POST"}),onSuccess:()=>{e.invalidateQueries({queryKey:["notifications"]})}})}},4191:function(e,t,r){"use strict";r.d(t,{Rm:function(){return i},mc:function(){return n},tN:function(){return c}});var s=r(3011),a=r(6885);function n(e){if(!e)return!0;try{let t=e.split(".");if(3!==t.length)return!0;let r=JSON.parse(atob(t[1]));if(!r.exp)return!1;let s=Math.floor(Date.now()/1e3);return r.exp<s}catch(e){return console.error("Error decoding token:",e),!0}}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:60;if(!e)return!0;try{let r=e.split(".");if(3!==r.length)return!0;let s=JSON.parse(atob(r[1]));if(!s.exp)return!1;let a=Math.floor(Date.now()/1e3);return s.exp<a+t}catch(e){return console.error("Error decoding token:",e),!0}}let l={getItem:e=>{let t=localStorage.getItem(e);return t?JSON.parse(t):null},setItem:(e,t)=>{localStorage.setItem(e,JSON.stringify(t))},removeItem:e=>{localStorage.removeItem(e)}},c=(0,s.U)()((0,a.tJ)((e,t)=>({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,isHydrated:!1,isInitialized:!1,setAuth:(t,r,s)=>{e({user:t,accessToken:r,refreshToken:s||null,isAuthenticated:!0,isHydrated:!0,isInitialized:!0})},updateUser:t=>e(e=>({...e,user:t})),setAccessToken:t=>e({accessToken:t}),clearAuth:()=>{e({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,isHydrated:!0,isInitialized:!0})},setHydrated:t=>e({isHydrated:t}),setInitialized:t=>e({isInitialized:t}),isTokenExpired:()=>{let{accessToken:e}=t();return n(e)}}),{name:"auth-storage",storage:(0,a.FL)(()=>l),partialize:e=>({user:e.user,accessToken:e.accessToken,refreshToken:e.refreshToken,isAuthenticated:e.isAuthenticated}),onRehydrateStorage:()=>e=>{if(e&&(e.isHydrated=!0,e.isAuthenticated&&e.accessToken)){let t=n(e.accessToken),r=!!e.refreshToken;t&&!r&&(console.warn("Token expired and no refresh token available, clearing auth"),e.user=null,e.accessToken=null,e.refreshToken=null,e.isAuthenticated=!1)}}}))},3053:function(e,t,r){"use strict";r.d(t,{Jo:function(){return s},Pm:function(){return a},ac:function(){return n}});let s=500,a={DRAFT:"Draft",PENDING_REVIEW:"Pending Review",APPROVED:"Approved",REJECTED:"Rejected",SOLD:"Sold",ARCHIVED:"Archived"},n={DRAFT:"bg-gray-100 text-gray-700",PENDING_REVIEW:"bg-amber-100 text-amber-700",APPROVED:"bg-emerald-100 text-emerald-700",REJECTED:"bg-red-100 text-red-700",SOLD:"bg-blue-100 text-blue-700",ARCHIVED:"bg-gray-100 text-gray-500"}},999:function(e,t,r){"use strict";r.d(t,{C:function(){return a}});var s=r(4438);let a=e=>{let{type:t,message:r,duration:a=2e3,position:n="top-center"}=e,i={color:"#fff"},l={success:"#4CAF50",error:"#FF5722",info:"#2196F3",warning:"#FFC107"};switch(s.Am.dismiss(),t){case"success":s.Am.success(r,{duration:a,style:{...i,backgroundColor:l.success},position:n});break;case"error":s.Am.error(r,{duration:a,style:{...i,backgroundColor:l.error},position:n});break;case"info":(0,s.Am)(r,{duration:a,style:{...i,backgroundColor:l.info},position:n});break;case"warning":(0,s.Am)(r,{duration:a,style:{...i,backgroundColor:l.warning},position:n});break;default:console.warn("Invalid toast type")}}}},function(e){e.O(0,[753,451,428,971,117,744],function(){return e(e.s=9395)}),_N_E=e.O()}]);